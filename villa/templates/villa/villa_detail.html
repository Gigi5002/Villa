{% extends 'base.html' %}
{% load static %}

{% block content %}

  <!-- ***** Preloader Start ***** -->
  <div id="js-preloader" class="js-preloader">
    <div class="preloader-inner">
      <span class="dot"></span>
      <div class="dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>
  <!-- ***** Preloader End ***** -->

  <div class="page-heading header-text">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <span class="breadcrumb"><a href="{% url 'index' %}">Главная</a> / <a href="{% url 'villa_list' %}">Недвижимость</a> / Детали недвижимости</span>
          <h3>{{ villa.address }}, {{ villa.region }} {{ villa.zip_code }}</h3>
        </div>
      </div>
    </div>
  </div>

  <div class="section best-deal">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="tabs-content">
            <div class="row">
              <div class="nav-wrapper">
                <ul class="nav nav-tabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="true">Детали недвижимости</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab" aria-controls="description" aria-selected="false">Описание</button>
                  </li>
                  {% if request.user.is_authenticated and request.user.status == 2 or request.user.is_admin %}
                  <li class="nav-item" role="presentation">
                    <a href="{% url 'villa_update' villa.id %}" class="nav-link btn btn-warning">Редактировать</a>
                  </li>
                  <li class="nav-item" role="presentation">
                    <a href="{% url 'villa_delete' villa.id %}" class="nav-link btn btn-danger" onclick="return confirm('Вы уверены, что хотите удалить эту недвижимость?')">Удалить</a>
                  </li>
                  {% endif %}
                </ul>
              </div>              
              <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="details" role="tabpanel" aria-labelledby="details-tab">
                  <div class="row">
                    <div class="col-lg-3">
                      <div class="info-table">
                        <ul>
                          <li>Общая площадь <span>{{ villa.area }} м²</span></li>
                          <li>Этаж <span>{{ villa.floor_number }}</span></li>
                          <li>Спальни <span>{{ villa.bedroom }}</span></li>
                          <li>Ванные <span>{{ villa.bathroom }}</span></li>
                          <li>Парковочные места <span>{{ villa.parking_space_capacity }}</span></li>
                          <li>Способ оплаты <span>{{ villa.payment_method }}</span></li>
                          <li>Безопасность <span>{% if villa.security == 1 %}Охраняемая{% else %}Не охраняемая{% endif %}</span></li>
                          <li>Материал <span>{{ villa.material }}</span></li>
                          <li>Категория <span>{{ villa.category }}</span></li>
                        </ul>
                      </div>
                    </div>
                    <div class="col-lg-6">
                      <div class="property-image">
                        <img src="{{ villa.image.url }}" alt="{{ villa.address }}" style="width: 100%; height: 400px; object-fit: cover; border-radius: 10px;">
                      </div>
                      <div class="property-price mt-3">
                        <h2 class="text-center text-success">${{ villa.price }}</h2>
                      </div>
                    </div>
                    <div class="col-lg-3">
                      <div class="property-info">
                        <h4>Информация о недвижимости</h4>
                        <p><strong>Адрес:</strong> {{ villa.address }}, {{ villa.region }} {{ villa.zip_code }}</p>
                        <p><strong>Создано:</strong> {{ villa.create_date|date:"j F Y" }}</p>
                        <p><strong>Обновлено:</strong> {{ villa.update_date|date:"j F Y" }}</p>
                        
                        <div class="icon-button mt-4">
                          <a href="#" class="btn btn-primary btn-lg"><i class="fa fa-calendar"></i> Записаться на просмотр</a>
                        </div>
                        
                        <div class="icon-button mt-3">
                          <a href="#" class="btn btn-outline-primary"><i class="fa fa-phone"></i> Связаться с агентом</a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="tab-pane fade" id="description" role="tabpanel" aria-labelledby="description-tab">
                  <div class="row">
                    <div class="col-lg-12">
                      <div class="description-content">
                        <h4>Описание недвижимости</h4>
                        <p>{{ villa.description|linebreaks }}</p>
                        
                        <div class="row mt-4">
                          <div class="col-lg-6">
                            <h5>Характеристики:</h5>
                            <ul>
                              <li>Площадь: {{ villa.area }} м²</li>
                              <li>Этаж: {{ villa.floor_number }}</li>
                              <li>Спальни: {{ villa.bedroom }}</li>
                              <li>Ванные: {{ villa.bathroom }}</li>
                              <li>Парковка: {{ villa.parking_space_capacity }} мест</li>
                            </ul>
                          </div>
                          <div class="col-lg-6">
                            <h5>Дополнительная информация:</h5>
                            <ul>
                              <li>Категория: {{ villa.category }}</li>
                              <li>Материал: {{ villa.material }}</li>
                              <li>Безопасность: {% if villa.security == 1 %}Охраняемая территория{% else %}Не охраняемая{% endif %}</li>
                              <li>Оплата: {{ villa.payment_method }}</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Similar Properties Section -->
  <div class="section properties">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 offset-lg-4">
          <div class="section-heading text-center">
            <h6>| Похожая недвижимость</h6>
            <h2>Посмотрите похожую недвижимость</h2>
          </div>
        </div>
      </div>
      <div class="row">
        {% for similar_villa in similar_villas|slice:":3" %}
          <div class="col-lg-4 col-md-6">
            <div class="item">
              <a href="{% url 'villa_detail' similar_villa.id %}">
                <img src="{{ similar_villa.image.url }}" alt="" style="max-height: 250px; object-fit: cover; width: 100%;">
              </a>
              <span class="category">{{ similar_villa.category }}</span>
              <h6>${{ similar_villa.price }}</h6>
              <h4><a href="{% url 'villa_detail' similar_villa.id %}">{{ similar_villa.address }}, {{ similar_villa.region }} {{ similar_villa.zip_code }}</a></h4>
              <ul>
                <li>Спальни: <span>{{ similar_villa.bedroom }}</span></li>
                <li>Ванные: <span>{{ similar_villa.bathroom }}</span></li>
                <li>Площадь: <span>{{ similar_villa.area }}м²</span></li>
              </ul>
              <div class="main-button">
                <a href="{% url 'villa_detail' similar_villa.id %}">Подробнее</a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

{% endblock %}